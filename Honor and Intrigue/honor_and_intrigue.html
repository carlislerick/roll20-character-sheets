<main class="root"><h3>BACKGROUND</h3>
<span>Name</span>
<input type="text" name="attr_character_name">
<span>Origin</span>
<input type="textarea" name="attr_origin">
<span>Motivation</span>
<input type="textarea" name="attr_motivation">
<span>Description</span>
<input type="textarea" name="attr_description">
<span>Languages</span>
<input type="textarea" name="attr_languages">
<span>Boons</span>
<input type="textarea" name="attr_boons">
<span>Flaws</span>
<input type="textarea" name="attr_flaws">

<h3>QUALITIES</h3>
<span>Might</span><input type="number" name="attr_might">
<span>Daring</span><input type="number" name="attr_daring">
<span>Savvy</span><input type="number" name="attr_savvy">
<span>Flair</span><input type="number" name="attr_flair">

<h3>COMBAT</h3>
<span>Brawl</span><input type="number" name="attr_brawl">
<span>Melee</span><input type="number" name="attr_melee">
<span>Ranged</span><input type="number" name="attr_ranged">
<span>Defense</span><input type="number" name="attr_defense">

<h3>CAREERS</h3>
<fieldset class="repeating_careers" style="margin-bottom: 5px;">
    <input type="textarea" name="attr_careerName">
    <input type="number" name="attr_careerRating">
    <select name="attr_qualityBase" style="width: 70px">
        <option value="">-</option>
        <option value="might">Might</option>
        <option value="daring">Daring</option>
        <option value="savvy">Savvy</option>
        <option value="flair">Flair</option>
    </select>
</fieldset>


<h3>LIFEBLOOD</h3>
<input type="number" name="attr_lifeblood_max"><input type="number" name="attr_lifeblood_current">
<h3>FORTUNE</h3><h3>COMPOSURE</h3><h3>ADVANCEMENT</h3>
<h3>EQUIPMENT</h3>
<h3>BACKSTORY</h3>


<h3>MANEUVERS</h3>
<fieldset class="repeating_maneuvers" style="margin-bottom: 5px;">
    <span></span>
    <input type="checkbox" name="attr_mastery" value="false">
    <input type="text" name="attr_maneuverName" value="">
    <select name="attr_qualityBase" style="width: 70px">
        <option value="might">Might</option>
        <option value="daring">Daring</option>
        <option value="savvy">Savvy</option>
        <option value="flair">Flair</option>
    </select>
    <select name="attr_combatBase"  style="width: 70px">
        <option value="brawl">Brawl</option>
        <option value="melee">Melee</option>
        <option value="ranged">Ranged</option>
        <option value="defense">Defense</option>
    </select>
    <span style="font-weight: 600;">VS</span>
    <select name="attr_verses"  style="width: 70px">
        <option value="brawl">Brawl</option>
        <option value="melee">Melee</option>
        <option value="ranged">Ranged</option>
        <option value="defense">Defense</option>
    </select>
    <button type="action" name="act_activate" >execute</button>
    <div>
        <input type="textarea" name="attr-maneuversdescription">
    </div>

</fieldset>
</main>

<script type="text/worker">
    function isRunningOnServer(){return self.dispatchEvent==undefined}function setActiveCharacterId(charId){var oldAcid=getActiveCharacterId();var msg={id:"0",type:"setActiveCharacter",data:charId};if(isRunningOnServer()==false){var ev=new CustomEvent("message");ev.data=msg;self.dispatchEvent(ev)}else{self.onmessage({data:msg})}return oldAcid}var _sIn=setInterval;setInterval=function(callback,timeout){var acid=getActiveCharacterId();_sIn(function(){var prevAcid=setActiveCharacterId(acid);callback();setActiveCharacterId(prevAcid)},timeout)};var _sto=setTimeout;setTimeout=function(callback,timeout){var acid=getActiveCharacterId();_sto(function(){var prevAcid=setActiveCharacterId(acid);callback();setActiveCharacterId(prevAcid)},timeout)};function getAttrsAsync(props){var acid=getActiveCharacterId();var prevAcid=null;return new Promise((resolve,reject)=>{prevAcid=setActiveCharacterId(acid);try{getAttrs(props,values=>{resolve(values)})}catch{reject()}}).finally(()=>{setActiveCharacterId(prevAcid)})}function setAttrsAsync(propObj,options){var acid=getActiveCharacterId();var prevAcid=null;return new Promise((resolve,reject)=>{prevAcid=setActiveCharacterId(acid);try{setAttrs(propObj,options,values=>{resolve(values)})}catch{reject()}}).finally(()=>{setActiveCharacterId(prevAcid)})}function getSectionIDsAsync(sectionName){var acid=getActiveCharacterId();var prevAcid=null;return new Promise((resolve,reject)=>{prevAcid=setActiveCharacterId(acid);try{getSectionIDs(sectionName,values=>{resolve(values)})}catch{reject()}}).finally(()=>{setActiveCharacterId(prevAcid)})}

    on("clicked:repeating_maneuvers:activate", async (info) => {
      console.log("Activate button clicked");
      const rollData = await getAttrsAsync([
        "repeating_maneuvers_qualityBase",
        "repeating_maneuvers_combatBase",
        "repeating_maneuvers_verses"
        ]);
        console.log("roll data is ", rollData);
        const rollNumbers = await getAttrsAsync([
            rollData.repeating_maneuvers_qualityBase,
            rollData.repeating_maneuvers_combatBase
        ]);
        
        console.log("roll numbers is ", rollNumbers[rollData.repeating_maneuvers_qualityBase]);
        startRoll(
            "&{template:test} {{name=Core Mechanic Roll}} {{roll1=[[2d6]]}}", (results) => {
                let total = results.results.roll1.result;
                let computed = total + parseInt(rollNumbers[rollData.repeating_maneuvers_qualityBase]) + parseInt(rollNumbers[rollData.repeating_maneuvers_combatBase]);

                finishRoll(results.rollId, {'roll1': computed});
            });
    });
</script>

<rolltemplate class="sheet-rolltemplate-test">
    <div class="sheet-template-container">
        <h1>{{name}}</h1>
        <div class="sheet-results">
            <h4>Result = {{roll1}}</h4>
            <h4>Custom Result = {{computed::roll1}}</h4>
        </div>
    </div>
</rolltemplate>